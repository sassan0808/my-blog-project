# ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ“‹ æ¦‚è¦

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ãŸç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ä»˜ãè¨˜äº‹æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ğŸ— ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

**Excalidraw ã§ä½œæˆ:** https://excalidraw.com

```json
{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "ui-layer",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 100,
      "y": 50,
      "strokeColor": "#1e40af",
      "backgroundColor": "#3B82F6",
      "width": 200,
      "height": 60,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "ui-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 150,
      "y": 70,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 100,
      "height": 20,
      "seed": 1,
      "text": "è¨˜äº‹ä½œæˆUI",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "usecase-layer",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 100,
      "y": 150,
      "strokeColor": "#6b21a8",
      "backgroundColor": "#8B5CF6",
      "width": 200,
      "height": 60,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "usecase-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 140,
      "y": 170,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 120,
      "height": 20,
      "seed": 1,
      "text": "Use Case Layer",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "domain-layer",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 100,
      "y": 250,
      "strokeColor": "#047857",
      "backgroundColor": "#10B981",
      "width": 200,
      "height": 60,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "domain-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 140,
      "y": 270,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 120,
      "height": 20,
      "seed": 1,
      "text": "Domain Layer",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "infra-layer",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 350,
      "y": 200,
      "strokeColor": "#d97706",
      "backgroundColor": "#F59E0B",
      "width": 200,
      "height": 100,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "infra-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 380,
      "y": 220,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 140,
      "height": 60,
      "seed": 1,
      "text": "Infrastructure\nLayer",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "core-layer",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 100,
      "y": 350,
      "strokeColor": "#dc2626",
      "backgroundColor": "#EF4444",
      "width": 200,
      "height": 60,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "core-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 150,
      "y": 370,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 100,
      "height": 20,
      "seed": 1,
      "text": "Core Layer",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "sanity-cms",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 600,
      "y": 150,
      "strokeColor": "#ec4899",
      "backgroundColor": "#F472B6",
      "width": 150,
      "height": 80,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "sanity-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 640,
      "y": 180,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 70,
      "height": 20,
      "seed": 1,
      "text": "Sanity CMS",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "rectangle",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "storage",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 600,
      "y": 280,
      "strokeColor": "#4b5563",
      "backgroundColor": "#6B7280",
      "width": 150,
      "height": 60,
      "seed": 1
    },
    {
      "type": "text",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "storage-text",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 620,
      "y": 300,
      "strokeColor": "#ffffff",
      "backgroundColor": "transparent",
      "width": 110,
      "height": 20,
      "seed": 1,
      "text": "Assets Storage",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "type": "arrow",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "arrow-ui-usecase",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 200,
      "y": 110,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "width": 0,
      "height": 40,
      "seed": 1,
      "startBinding": null,
      "endBinding": null,
      "points": [[0, 0], [0, 40]],
      "lastCommittedPoint": [0, 40]
    },
    {
      "type": "arrow",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "arrow-usecase-domain",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 200,
      "y": 210,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "width": 0,
      "height": 40,
      "seed": 1,
      "startBinding": null,
      "endBinding": null,
      "points": [[0, 0], [0, 40]],
      "lastCommittedPoint": [0, 40]
    },
    {
      "type": "arrow",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "arrow-usecase-infra",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 300,
      "y": 180,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "width": 50,
      "height": 40,
      "seed": 1,
      "startBinding": null,
      "endBinding": null,
      "points": [[0, 0], [50, 40]],
      "lastCommittedPoint": [50, 40]
    },
    {
      "type": "arrow",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "arrow-infra-sanity",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 550,
      "y": 220,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "width": 50,
      "height": -30,
      "seed": 1,
      "startBinding": null,
      "endBinding": null,
      "points": [[0, 0], [50, -30]],
      "lastCommittedPoint": [50, -30]
    },
    {
      "type": "arrow",
      "version": 1,
      "versionNonce": 1,
      "isDeleted": false,
      "id": "arrow-sanity-storage",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 675,
      "y": 230,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "width": 0,
      "height": 50,
      "seed": 1,
      "startBinding": null,
      "endBinding": null,
      "points": [[0, 0], [0, 50]],
      "lastCommittedPoint": [0, 50]
    }
  ],
  "appState": {
    "gridSize": null,
    "viewBackgroundColor": "#ffffff"
  },
  "files": {}
}
```

**ğŸ‘† ã“ã® JSON ã‚’ https://excalidraw.com ã«ã‚³ãƒ”ãƒšã—ã¦é–‹ã„ã¦ãã ã•ã„ï¼**

### ğŸ“ ä½¿ã„æ–¹
1. https://excalidraw.com ã‚’é–‹ã
2. å·¦ä¸Šã®ã€ŒOpenã€â†’ã€ŒLoad from clipboardã€
3. ä¸Šè¨˜JSONã‚’ãƒšãƒ¼ã‚¹ãƒˆ
4. æ‰‹æ›¸ãé¢¨ã®å›³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼

### âœ¨ å›³ã®ç‰¹å¾´
- ğŸ¨ æ‰‹æ›¸ãé¢¨ã§ãŠã—ã‚ƒã‚Œ
- ğŸŒˆ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã«è‰²åˆ†ã‘ï¼ˆé’â†’ç´«â†’ç·‘â†’ã‚ªãƒ¬ãƒ³ã‚¸â†’èµ¤ï¼‰
- â¡ï¸ ä¾å­˜é–¢ä¿‚ã‚’çŸ¢å°ã§è¡¨ç¾
- ğŸ“± ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ§‹é€ ã‚’è¦–è¦šåŒ–

## ğŸ“ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥æ§‹æˆ

### 1. **Use Case Layer** (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)
```
src/lib/application/use-cases/
â””â”€â”€ create-article-with-images.ts
    â”œâ”€â”€ CreateArticleWithImagesUseCase (ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹)
    â”œâ”€â”€ CreateArticleRequest (å…¥åŠ›å‹)
    â””â”€â”€ CreateArticleResult (å‡ºåŠ›å‹)
```

**è²¬å‹™:**
- è¨˜äº‹ä½œæˆãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡
- ç”»åƒå‡¦ç†ã®çµ±åˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

### 2. **Domain Layer** (ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«)
```
src/lib/domain/entities/
â”œâ”€â”€ article.ts
â”‚   â”œâ”€â”€ Article (è¨˜äº‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£)
â”‚   â”œâ”€â”€ ArticleStatuses (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šæ•°)
â”‚   â””â”€â”€ ArticleCategories (ã‚«ãƒ†ã‚´ãƒªãƒ¼å®šæ•°)
â”œâ”€â”€ image.ts
â”‚   â””â”€â”€ Image (ç”»åƒã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£)
â””â”€â”€ media.interface.ts
    â”œâ”€â”€ MediaTypes (ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—å®šæ•°)
    â”œâ”€â”€ ImageFormats (ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®šæ•°)
    â””â”€â”€ ImagePlacements (é…ç½®æ–¹æ³•å®šæ•°)
```

**è²¬å‹™:**
- ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®å®Ÿè£…
- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç®¡ç†

### 3. **Infrastructure Layer** (å¤–éƒ¨é€£æº)
```
src/lib/infrastructure/
â”œâ”€â”€ image-processing/
â”‚   â”œâ”€â”€ sharp-processor.ts (Sharpå®Ÿè£…)
â”‚   â””â”€â”€ image-processor.interface.ts
â””â”€â”€ sanity/
    â”œâ”€â”€ sanity-image-uploader.ts
    â”œâ”€â”€ sanity-article-publisher.ts
    â””â”€â”€ sanity-client.interface.ts
```

**è²¬å‹™:**
- ç”»åƒå‡¦ç†ï¼ˆSharp.jsï¼‰
- Sanity CMSé€£æº
- ãƒ•ã‚¡ã‚¤ãƒ«I/Oæ“ä½œ
- å¤–éƒ¨APIé€šä¿¡

### 4. **Core Layer** (å…±é€šæ©Ÿèƒ½)
```
src/lib/core/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.interface.ts
â”‚   â””â”€â”€ environment-config.ts
â”œâ”€â”€ errors/
â”‚   â”œâ”€â”€ base-error.ts
â”‚   â”œâ”€â”€ image-error.ts
â”‚   â””â”€â”€ sanity-error.ts
â””â”€â”€ logging/
    â”œâ”€â”€ logger.interface.ts
    â””â”€â”€ console-logger.ts
```

**è²¬å‹™:**
- è¨­å®šç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ­ã‚®ãƒ³ã‚°
- æ¨ªæ–­çš„é–¢å¿ƒäº‹

## ğŸ”„ å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI
    participant UseCase
    participant ImageProcessor
    participant SanityUploader
    participant ArticlePublisher
    participant Sanity

    User->>UI: è¨˜äº‹ã¨ç”»åƒã‚’å…¥åŠ›
    UI->>UseCase: execute(request)
    
    UseCase->>UseCase: å…¥åŠ›æ¤œè¨¼
    
    loop å„ç”»åƒã«å¯¾ã—ã¦
        UseCase->>ImageProcessor: validate(image)
        ImageProcessor-->>UseCase: æ¤œè¨¼çµæœ
        
        UseCase->>ImageProcessor: optimize(image)
        ImageProcessor-->>UseCase: æœ€é©åŒ–æ¸ˆã¿ç”»åƒ
    end
    
    UseCase->>ArticlePublisher: createArticleWithAssets()
    
    ArticlePublisher->>SanityUploader: uploadImages(images)
    loop å„ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        SanityUploader->>Sanity: assets.upload()
        Sanity-->>SanityUploader: ã‚¢ã‚»ãƒƒãƒˆID
    end
    SanityUploader-->>ArticlePublisher: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµæœ
    
    ArticlePublisher->>Sanity: create(article)
    Sanity-->>ArticlePublisher: ä½œæˆæ¸ˆã¿è¨˜äº‹
    
    ArticlePublisher-->>UseCase: è¨˜äº‹ã¨ã‚¢ã‚»ãƒƒãƒˆæƒ…å ±
    UseCase-->>UI: CreateArticleResult
    UI-->>User: å®Œäº†é€šçŸ¥
```

## ğŸ”§ TypeScriptå³æ ¼è¨­å®šå¯¾å¿œ

### 1. **verbatimModuleSyntax å¯¾å¿œ**
```typescript
// âŒ Before
import { LogLevel } from './logger.interface';

// âœ… After
import type { LogLevel } from './logger.interface';
import { LogLevels } from './logger.interface';
```

### 2. **erasableSyntaxOnly å¯¾å¿œ**
```typescript
// âŒ Before (enum)
export enum ArticleStatus {
  DRAFT = 'draft',
  PUBLISHED = 'published'
}

// âœ… After (const assertion)
export const ArticleStatuses = {
  DRAFT: 'draft',
  PUBLISHED: 'published'
} as const;

export type ArticleStatus = typeof ArticleStatuses[keyof typeof ArticleStatuses];
```

## ğŸ“Š å‹å®‰å…¨æ€§ã®å‘ä¸Š

### 1. **Sanityå‹çµ±åˆ**
```typescript
// å‹å®‰å…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
toSanityDocument(): Record<string, unknown> & { _type: string } {
  return {
    _type: 'post',
    // ... other fields
  };
}
```

### 2. **æ®µéšçš„å‹å¤‰æ›**
```typescript
// unknownçµŒç”±ã®å®‰å…¨ãªå¤‰æ›
const createdDocument = await this.client.create(sanityDoc);
return createdDocument as unknown as SanityPost;
```

## ğŸ¯ ä¸»è¦ãªæ”¹å–„ç‚¹

1. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¡ç”¨**
   - é–¢å¿ƒäº‹ã®åˆ†é›¢ãŒæ˜ç¢º
   - ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š
   - ä¿å®ˆæ€§ã®æ”¹å–„

2. **å‹å®‰å…¨æ€§ã®å¾¹åº•**
   - anyå‹ã®å®Œå…¨æ’é™¤
   - type-only importã®é©åˆ‡ãªä½¿ç”¨
   - const assertionãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¡ç”¨

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**
   - ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹éšå±¤
   - è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±
   - é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ä¼æ’­

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - ç”»åƒã®ä¸¦åˆ—å‡¦ç†
   - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é€šçŸ¥
   - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªå‡¦ç†

## ğŸ“ ä»Šå¾Œã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

1. **AIç”»åƒè§£ææ©Ÿèƒ½**
   - è‡ªå‹•altãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
   - ä¸é©åˆ‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¤œå‡º
   - ç”»åƒåˆ†é¡

2. **é«˜åº¦ãªç”»åƒå‡¦ç†**
   - WebPè‡ªå‹•å¤‰æ›
   - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç”»åƒç”Ÿæˆ
   - ç”»åƒCDNçµ±åˆ

3. **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ©Ÿèƒ½**
   - ä¸‹æ›¸ãä¿å­˜
   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
   - æ‰¿èªãƒ•ãƒ­ãƒ¼